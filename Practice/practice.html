<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title> LIY: Practice </title>
</head>
<body>

<script src="sample.js"></script>

<script>
let ly_globals = {
    cur_qst: 0
};

let is_correct = new Array(qst_bank.length);

for (var i = 0; i < is_correct.length; ++i) {
   is_correct[i] = false;
}

function calc_remain_q() {
  var r = 0;
  for (var i = 0; i < is_correct.length; ++i) {
     if (is_correct[i] == false) {
        r++;
     }
  }
  return r;
}


window.onload = function () {
  let my_choice_list = document.getElementById("choice_list");

  let question = document.getElementById('qst');
  question.innerHTML = qst_bank[ly_globals.cur_qst].q;

  for (var i = 0; i < qst_bank[ly_globals.cur_qst].c.length; ++i) {
     var choice = qst_bank[ly_globals.cur_qst].c[i];
     var radio_id = `choice_${i}`;
     let li_elem = document.createElement("li");

     var v = 0;
     if (qst_bank[ly_globals.cur_qst].a == i) {
        v = 1;
     } 

     li_elem.innerHTML = `<input type="radio" id="${radio_id}" name="choice" value="${v}"/> ${choice}</li>`;
     
     li_elem.id = `li_choice_${i}`;
     my_choice_list.appendChild(li_elem);
  }
  set_total_questions();
  set_questions_remaining();
};

function set_total_questions() {
   let total_q = document.getElementById("total_q");
   total_q.innerHTML = `Total Questions: ${qst_bank.length}`;
}

/** Calculate the remaining questions that needs to be answered correctly. */
function set_questions_remaining() {
   let remain_q = document.getElementById("remain_q");
   remain_q.innerHTML = `Questions remaining: ${calc_remain_q()}`;
}

/* Remove all the choices of the given question. */
function remove_choices() {
   let choice_list = document.getElementById("choice_list");
   while (choice_list.lastChild) {
     choice_list.removeChild(choice_list.lastChild);
   }
}

function next_question() {

   if (calc_remain_q() == 0) {
      let question = document.getElementById('qst');
      question.innerHTML = "Success! You have completed this practice!!";

      /* Remove the old choices. */
      remove_choices();
      return;
   }

   ly_globals.cur_qst++;

   if (ly_globals.cur_qst >= qst_bank.length) {
      ly_globals.cur_qst = 0;
   }

   while (is_correct[ly_globals.cur_qst] == true) {
     ++ly_globals.cur_qst;
   }

   let question = document.getElementById('qst');
   question.innerHTML = qst_bank[ly_globals.cur_qst].q;

   /* Remove the old choices and add the new ones. */
   remove_choices();

   for (var i = 0; i < qst_bank[ly_globals.cur_qst].c.length; ++i) {
      var li_name = `li_choice_${i}`;
      let li_elem = document.getElementById(li_name);
      var radio_id = `choice_${i}`;

      var choice = `qst_bank[ly_globals.cur_qst].c[i]`;

      if (li_elem == null) {
         let my_choice_list = document.getElementById("choice_list");
         li_elem = document.createElement("li");
         li_elem.id = li_name;
         my_choice_list.appendChild(li_elem);
      }

      var v = 0;
      if (qst_bank[ly_globals.cur_qst].a == i) {
         v = 1;
      } 
         
      li_elem.innerHTML = `<input type="radio" id="${radio_id}" name="choice" value="${v}"/> ${eval(choice)}`;
   }
   cur_qst_elem.value = ly_globals.cur_qst;
}

function verify_choice() {
  let user_chosen = 0;
  let choices = document.getElementsByName('choice');
  var answer = 0;
  let li_elem;
  let li_elem_selected;
  for (var i = 0; i < choices.length; ++i) {
    var li_name = `li_choice_${i}`;
    li_elem = document.getElementById(li_name);
    if (choices[i].checked) {
      li_elem_selected = li_elem;
    }
    if (choices[i].checked && choices[i].value == 1) {
        answer = 1;
    } else {
      li_elem.style.background = "none";
    }
  }
  if (answer == 0) {
    li_elem_selected.style.background = "red";
  } else {
    is_correct[ly_globals.cur_qst] = true;
    set_questions_remaining();
    li_elem_selected.style.background = "green";
  }
}


</script>

<div id="mcq">
   <p id="qst"> Question </p>
   <ul id="choice_list" style="list-style-type: none;">
   <!-- No list items are here on purpose. -->
   </ul>
   <input type="button" value="Verify" onclick="verify_choice()" />
   <input type="button" value="Next" onclick="next_question()" />
</div>

<div id="stats">
  <p id="total_q">Total questions</p>
  <p id="remain_q">Questions remaining</p>
</div>

</body>
</html>

