<!--
Learn It Yourself (LIY) - Software to Promote Self Study

Copyright (C) 2021, Annamalai Gurusami <annamalai.gurusami@gmail.com>

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <https://www.gnu.org/licenses/>.
-->

<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title> LIY: Practice Square Table Upto 20 </title>
<style>

#main_table {
   border: 1px solid blue;
   padding: 30px;
   margin-left: auto;
   margin-right: auto;
   margin-bottom: auto;
   font-size: x-large;
}

#table_progress {
  width: 90%;
  margin-top: 20px;
  margin-left: auto;
  margin-right: auto;">
}

#question {
}

</style>

</head>
<body>

<script>
/******************************************************************************/
/* Global Variables */

const gBankSize = 30; /* Number of questions in the bank. */
const gXupto = 100;
const gYupto = 100;
var gCurQst = 0;
let gQuestionBank;
let gIsCorrect;
let gStopWatch;

/******************************************************************************/
/* Classes */

class TwoNumbers {
   constructor(x, y) {
       this.x = x;
       this.y = y;
   }

   is_same(obj) {
       if ((obj.x == this.x && obj.y == this.y) ||
           (obj.x == this.y && obj.y == this.x)) {
           return true;
       }
       return false;
   }
}

class StopWatch {
   constructor(min, sec) {
       this.min = min;
       this.sec = sec;
   }

   getMin() {
       return this.min < 10 ? `0${this.min}` : `${this.min}`;
   }

   getSec() {
       return this.sec < 10 ? `0${this.sec}` : `${this.sec}`;
   }

   getValue() {
       return `${this.getMin()}:${this.getSec()}`;
   }

   tick() {
       this.sec++;
       if (this.sec == 60) {
           this.min++;
           this.sec = 0;
       }
       if (this.min == 60) {
           this.min = 0;
       }
       return `${this.getMin()}:${this.getSec()}`;
   }
}

/******************************************************************************/
/* Functions */

function init_qbank() {
   gQuestionBank = new Array(gBankSize);
   for (var i = 0; i < gQuestionBank.length; ++i) {
       var x = Math.floor(Math.random() * gXupto);
       var y = Math.floor(Math.random() * gYupto);
       let obj = new TwoNumbers(x, y);
       var duplicate = false;
       for (var j = 0; j < i; ++j) {
           if (obj.is_same(gQuestionBank[j])) {
               duplicate = true;
               break;
           }
       }
       if (duplicate == true) {
       } else {
           gQuestionBank[i] = obj;
       }
   }
}


function calcRemainQ() {
      var r = 0;
      for (var i = 0; i < gIsCorrect.length; ++i) {
         if (gIsCorrect[i] == false) {
            r++;
         }
      }
      return r;
}

function initIsCorrect() {
   gIsCorrect = new Array(gBankSize);
   for (var i = 0; i < gIsCorrect.length; ++i) {
       gIsCorrect[i] = false;
   }
}

function shuffle() {
   for (var i = gQuestionBank.length - 1; i !== 0; --i) {
       let j = Math.floor(Math.random() * i);
       let k = gQuestionBank[i];
       gQuestionBank[i] = gQuestionBank[j];
       gQuestionBank[j] = k;
  }
}

function set_progress() {
   let i = calcRemainQ();
   let p_2 = (i / gQuestionBank.length) * 100;
   let p_1 = 100 - p_2;
   let progress_1 = document.getElementById("progress_1");
   let progress_2 = document.getElementById("progress_2");
   progress_1.style.width = `${p_1}%`;
   progress_1.innerHTML = gQuestionBank.length - i;
   progress_2.style.width = `${p_2}%`;
   progress_2.innerHTML = i;
}

function set_total_questions(total) {
   let total_q = document.getElementById("total_q");
   total_q.innerHTML = `Total Questions: ${total}`;
}

/** Calculate the remaining questions that needs to be answered correctly. */
function set_questions_remaining() {
   let remain_q = document.getElementById("remain_q");
   remain_q.innerHTML = `Questions remaining: ${calcRemainQ()}`;
}

function finishPractice() {
   window.clearInterval(1000);
   let trElem = document.getElementById("main_row");
   trElem.parentNode.removeChild(trElem);
   let trSuccess = document.createElement("tr");
   trSuccess.innerHTML = "Success! You have completed this practice!!";
   let tableElem = document.getElementById("main_table");
   tableElem.appendChild(trSuccess);
   let trTimer = document.createElement("tr");
   trTimer.innerHTML = `Time Taken: ${gStopWatch.getValue()}`;
   tableElem.appendChild(trTimer);
}

function nextQuestion() {
   let in_elem = document.getElementById("user_integer");
   let td_elem = document.getElementById("result_here");
   in_elem.value = "";
   td_elem.style.background = "none";
   td_elem.innerHTML = "";

   if (calcRemainQ() == 0) {
       finishPractice();
       return;
   }
   gCurQst++;

   if (gCurQst >= gQuestionBank.length) {
       gCurQst = 0;
   }

   while (gIsCorrect[gCurQst] == true) {
       ++gCurQst;
       if (gCurQst == gQuestionBank.length) {
           gCurQst = 0;
       }
   }

   let question = document.getElementById('question');
   let obj = gQuestionBank[gCurQst];
   question.innerHTML = `${obj.x} &times; ${obj.y}`;
   enableUserInput();
   setFocus();
}

function verify_integer() {
   let in_elem = document.getElementById("user_integer");
   let td_elem = document.getElementById("result_here");
   var user_given = in_elem.value;
   var expected = gQuestionBank[gCurQst].x * gQuestionBank[gCurQst].y; 
   if (user_given == expected) {
       gIsCorrect[gCurQst] = true;
       td_elem.style.background = "green";
       td_elem.style.textAlign = "center";
       td_elem.innerHTML = "Correct";
   } else {
       gIsCorrect[gCurQst] = false;
       td_elem.style.background = "red";
       td_elem.style.textAlign = "center";
       td_elem.innerHTML = "Wrong";
   }
   set_progress();
   disableUserInput();
   setFocusToNext();
}

function setTitle() {
   let in_elem = document.getElementById("ly_title");
   ly_title.innerHTML = `Practice Multiplication Upto ${gXupto} &times; ${gYupto}`;
}

function clickPress(e) {
   if (e.keyCode == 13) {
       verify_integer();
   }
}

function setFocusToNext() {
   let userNext = document.getElementById("user_next");
   userNext.focus();
}

function setFocus() {
   let userInput = document.getElementById("user_integer");
   userInput.focus();
}

function disableUserInput() {
   let userInput = document.getElementById("user_integer");
   let userGiven = document.getElementById("user_given");
   userInput.disabled = true;
   userGiven.disabled = true;
}

function enableUserInput() {
   let userInput = document.getElementById("user_integer");
   let userGiven = document.getElementById("user_given");
   userInput.disabled = false;
   userGiven.disabled = false;
}

function updateStopWatch() {
   let stopWatch = document.getElementById("stop_watch");
   stopWatch.textContent = `Timer: ${gStopWatch.tick()}`;
}

window.onload = function() {
   init_qbank();
   setTitle();
   initIsCorrect();
   shuffle();
   nextQuestion();
   set_progress();
   setFocus();
   gStopWatch = new StopWatch(0,0);
   window.setInterval(updateStopWatch, 1000);
}

</script>

<span id="stop_watch">Timer: 00:00</span>

<h1 id="ly_title" style="text-align: center;"> Practice Multiplication  </h1>


<div style="margin-left: auto; margin-right: auto;">
   <table id="main_table">
       <tr id="main_row"> 
           <td> <p id="question"> Question: </p> </td>
           <td> <p> = </p> </td>
           <td> <input id="user_integer" type="text" autocomplete="off" value=""
                       onkeypress="clickPress(event);"/> </td>
           <td> <input id="user_given" type="button" value="Verify" onclick="verify_integer()"/> </td>
           <td> <input id="user_next" type="button" value="Next" onclick="nextQuestion()" /> </td>
       </tr>
       <tr>
           <td id="result_here" style="background-color: none;" colspan="5"> </td>
       </tr>
   </table>
</div>

<div style="width: 100%;">
<table id="table_progress" style="width: 100%; margin-left: auto; margin-right: auto;">
  <tr>
    <td id="progress_1" style="text-align: center; width: 0%; border: 1px solid green; background-color: green"> </td>
    <td id="progress_2" style="text-align: center; width: 100%; border: 1px solid red; background-color: none;"> </td>
  </tr>
</table>
</div>

</body>
</html>

